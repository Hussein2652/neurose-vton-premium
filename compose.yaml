services:
  api:
    image: neurose-vton-premium:dev
    build:
      context: .
      dockerfile: Dockerfile
    pull_policy: never
    ports:
      - "8000:8000"
    gpus: all
    environment:
      NEUROSE_DEFAULT_SEED: "${NEUROSE_DEFAULT_SEED:-12345}"
      NEUROSE_STRICT_DETERMINISM: "${NEUROSE_STRICT_DETERMINISM:-1}"
      NEUROSE_LOG_LEVEL: "${NEUROSE_LOG_LEVEL:-INFO}"
      NEUROSE_MODEL_DEPTH: "/app/storage/models/zoedepth_m12_nk/v1/ZoeD_M12_NK.pt"
    volumes:
      - ./storage:/app/storage:ro
      - ./manual_downloads:/app/manual_downloads:ro
      - ./third_party:/app/third_party:ro
      - ./outputs:/app/outputs
      - ./runtime_cache:/app/runtime_cache
      - ./neurose_vton:/app/neurose_vton
      - ./scripts:/app/scripts
    develop:
      watch:
        - action: sync
          path: ./neurose_vton
          target: /app/neurose_vton
          ignore:
            - "**/__pycache__/**"
            - "**/*.pyc"
        - action: sync
          path: ./scripts
          target: /app/scripts
        - action: rebuild
          path: ./requirements.lock
        - action: rebuild
          path: ./Dockerfile
